'use strict';
var Nav = function() {
    return React.createElement('h1', null, 'Welcome to Evently!');
  },
  _createClass = (function() {
    function e(e, t) {
      for (var n = 0; n < t.length; n++) {
        var r = t[n];
        (r.enumerable = r.enumerable || !1),
          (r.configurable = !0),
          'value' in r && (r.writable = !0),
          Object.defineProperty(e, r.key, r);
      }
    }
    return function(t, n, r) {
      return n && e(t.prototype, n), r && e(t, r), t;
    };
  })();
function _classCallCheck(e, t) {
  if (!(e instanceof t))
    throw new TypeError('Cannot call a class as a function');
}
function _possibleConstructorReturn(e, t) {
  if (!e)
    throw new ReferenceError(
      "this hasn't been initialised - super() hasn't been called"
    );
  return !t || ('object' != typeof t && 'function' != typeof t) ? e : t;
}
function _inherits(e, t) {
  if ('function' != typeof t && null !== t)
    throw new TypeError(
      'Super expression must either be null or a function, not ' + typeof t
    );
  (e.prototype = Object.create(t && t.prototype, {
    constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 },
  })),
    t &&
      (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : (e.__proto__ = t));
}
var Event = (function(e) {
    function t() {
      var e, n, r;
      _classCallCheck(this, t);
      for (var a = arguments.length, o = Array(a), c = 0; c < a; c++)
        o[c] = arguments[c];
      return (
        (n = r = _possibleConstructorReturn(
          this,
          (e = t.__proto__ || Object.getPrototypeOf(t)).call.apply(
            e,
            [this].concat(o)
          )
        )),
        (r.formatDateTime = function(e) {
          return new Date(e + 'z').toLocaleString('en-us', {
            weekday: 'long',
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit',
            timeZoneName: 'short',
          });
        }),
        _possibleConstructorReturn(r, n)
      );
    }
    return (
      _inherits(t, e),
      _createClass(t, [
        {
          key: 'render',
          value: function() {
            var e = this,
              t = this.props.event,
              n = t.id,
              r = t.name,
              a = t.short_location,
              o = t.status,
              c = t.start_date,
              i = t.participant_count,
              s = t.registered,
              l = t.description;
            return React.createElement(
              'div',
              { className: 'event' },
              React.createElement(
                'header',
                null,
                React.createElement('h4', null, r),
                React.createElement('h5', null, a),
                React.createElement('hr', null)
              ),
              React.createElement('p', null, l),
              React.createElement('hr', null),
              React.createElement(
                'section',
                null,
                React.createElement(
                  'span',
                  null,
                  React.createElement('strong', null, 'When:'),
                  this.formatDateTime(c)
                ),
                React.createElement(
                  'span',
                  null,
                  React.createElement('strong', null, 'Status:'),
                  o
                ),
                React.createElement(
                  'span',
                  null,
                  React.createElement('strong', null, 'Participants:'),
                  i
                ),
                React.createElement(
                  'button',
                  {
                    onClick: function(t) {
                      return e.props.onClick(n, s);
                    },
                    'data-eventid': n,
                    className: s ? 'registered' : void 0,
                  },
                  s ? 'Unregister' : 'Register'
                )
              )
            );
          },
        },
      ]),
      t
    );
  })(React.Component),
  Pagination = function(e) {
    var t = e.pageInfo,
      n = t.previous,
      r = t.next,
      a = t.page,
      o = t.pages;
    return React.createElement(
      'div',
      { className: 'pagination' },
      React.createElement(
        'button',
        {
          onClick: function() {
            return e.fetchPage(n);
          },
          disabled: !n,
        },
        '← Prev'
      ),
      React.createElement('span', null, 'Page ', a, ' of ', o),
      React.createElement(
        'button',
        {
          onClick: function() {
            return e.fetchPage(r);
          },
          disabled: !r,
        },
        'Next →'
      )
    );
  };
_createClass = (function() {
  function e(e, t) {
    for (var n = 0; n < t.length; n++) {
      var r = t[n];
      (r.enumerable = r.enumerable || !1),
        (r.configurable = !0),
        'value' in r && (r.writable = !0),
        Object.defineProperty(e, r.key, r);
    }
  }
  return function(t, n, r) {
    return n && e(t.prototype, n), r && e(t, r), t;
  };
})();
function _toConsumableArray(e) {
  if (Array.isArray(e)) {
    for (var t = 0, n = Array(e.length); t < e.length; t++) n[t] = e[t];
    return n;
  }
  return Array.from(e);
}
function _classCallCheck(e, t) {
  if (!(e instanceof t))
    throw new TypeError('Cannot call a class as a function');
}
function _possibleConstructorReturn(e, t) {
  if (!e)
    throw new ReferenceError(
      "this hasn't been initialised - super() hasn't been called"
    );
  return !t || ('object' != typeof t && 'function' != typeof t) ? e : t;
}
function _inherits(e, t) {
  if ('function' != typeof t && null !== t)
    throw new TypeError(
      'Super expression must either be null or a function, not ' + typeof t
    );
  (e.prototype = Object.create(t && t.prototype, {
    constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 },
  })),
    t &&
      (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : (e.__proto__ = t));
}
var Events = (function(e) {
  function t(e) {
    _classCallCheck(this, t);
    var n = _possibleConstructorReturn(
      this,
      (t.__proto__ || Object.getPrototypeOf(t)).call(this, e)
    );
    return (
      (n.fetchPage = function(e) {
        fetch(e)
          .then(function(e) {
            return e.json();
          })
          .then(function(t) {
            var r = t.meta,
              a = r.limit,
              o = r.offset,
              c = r.next,
              i = r.previous,
              s = r.total_count;
            n.setState({
              events: t.objects,
              page: parseInt(o / a) + 1,
              pages: Math.ceil(s / a),
              next: c,
              previous: i,
              url: e,
            });
          });
      }),
      (n.register = function(e, t) {
        fetch('api/v1/events/' + e + '/register/', {
          method: t ? 'DELETE' : 'POST',
          headers: { 'Content-Type': 'application/json; charset=utf-8' },
        })
          .then(function(e) {
            return e.json();
          })
          .then(function(e) {
            []
              .concat(_toConsumableArray(n.state.events))
              .forEach(function(t, r) {
                t.id === e.id &&
                  n.setState(function(t) {
                    return {
                      events: [].concat(
                        _toConsumableArray(t.events.slice(0, r)),
                        [e],
                        _toConsumableArray(t.events.slice(r + 1))
                      ),
                    };
                  });
              });
          })
          .catch(function(e) {
            return n.setState({ error: e });
          });
      }),
      (n.state = {
        events: [],
        page: 0,
        pages: 0,
        next: '',
        previous: '',
        url: '',
        error: '',
      }),
      n
    );
  }
  return (
    _inherits(t, e),
    _createClass(t, [
      {
        key: 'componentDidMount',
        value: function() {
          this.fetchPage('api/v1/events/');
        },
      },
      {
        key: 'render',
        value: function() {
          var e = this,
            t = {
              previous: this.state.previous,
              next: this.state.next,
              page: this.state.page,
              pages: this.state.pages,
            };
          return React.createElement(
            'div',
            { className: 'center' },
            React.createElement(Pagination, {
              pageInfo: t,
              fetchPage: this.fetchPage,
            }),
            React.createElement(
              'div',
              { className: 'events' },
              this.state.events.map(function(t) {
                return React.createElement(Event, {
                  event: t,
                  key: t.id,
                  onClick: e.register,
                });
              })
            ),
            React.createElement(Pagination, {
              pageInfo: t,
              fetchPage: this.fetchPage,
            })
          );
        },
      },
    ]),
    t
  );
})(React.Component);
_createClass = (function() {
  function e(e, t) {
    for (var n = 0; n < t.length; n++) {
      var r = t[n];
      (r.enumerable = r.enumerable || !1),
        (r.configurable = !0),
        'value' in r && (r.writable = !0),
        Object.defineProperty(e, r.key, r);
    }
  }
  return function(t, n, r) {
    return n && e(t.prototype, n), r && e(t, r), t;
  };
})();
function _classCallCheck(e, t) {
  if (!(e instanceof t))
    throw new TypeError('Cannot call a class as a function');
}
function _possibleConstructorReturn(e, t) {
  if (!e)
    throw new ReferenceError(
      "this hasn't been initialised - super() hasn't been called"
    );
  return !t || ('object' != typeof t && 'function' != typeof t) ? e : t;
}
function _inherits(e, t) {
  if ('function' != typeof t && null !== t)
    throw new TypeError(
      'Super expression must either be null or a function, not ' + typeof t
    );
  (e.prototype = Object.create(t && t.prototype, {
    constructor: { value: e, enumerable: !1, writable: !0, configurable: !0 },
  })),
    t &&
      (Object.setPrototypeOf ? Object.setPrototypeOf(e, t) : (e.__proto__ = t));
}
var Home = (function(e) {
    function t() {
      return (
        _classCallCheck(this, t),
        _possibleConstructorReturn(
          this,
          (t.__proto__ || Object.getPrototypeOf(t)).apply(this, arguments)
        )
      );
    }
    return (
      _inherits(t, e),
      _createClass(t, [
        {
          key: 'render',
          value: function() {
            return React.createElement(
              'div',
              { className: 'home' },
              React.createElement(Nav, null),
              React.createElement(Events, null)
            );
          },
        },
      ]),
      t
    );
  })(React.Component),
  domContainer = document.querySelector('#app');
ReactDOM.render(React.createElement(Home, null), domContainer);
